<nz-breadcrumb>
  <nz-breadcrumb-item> Relay Factory</nz-breadcrumb-item>
  <nz-breadcrumb-item> Check Sheet </nz-breadcrumb-item>
  <nz-breadcrumb-item> Create Item </nz-breadcrumb-item>
  <nz-breadcrumb-item> Line </nz-breadcrumb-item>
  <nz-breadcrumb-item> Công đoạn </nz-breadcrumb-item>
  <nz-breadcrumb-item> Hạng mục </nz-breadcrumb-item>
</nz-breadcrumb>
<br />
<h3>Công đoạn: {{ processName }}</h3>

<button
  *ngIf="master == 0"
  nz-button
  nzType="primary"
  (click)="showAddNewModal()"
>
  Thêm hạng mục
</button>
<br />
<nz-table
  #itemTable
  nzBordered
  [nzData]="items"
  [nzFrontPagination]="true"
  [nzScroll]="{ x: '1100px' }"
>
  <ng-template [ngIf]="master == 0">
    <thead>
      <tr>
        <th class="text-center" style="width: 80px">STT</th>
        <th class="text-center" style="width: 300px">Tên hạng mục</th>
        <th class="text-center" style="width: 160px">Loại hạng mục</th>
        <th class="text-center" style="width: 160px">Đơn vị kiểm tra</th>
        <th class="text-center" style="width: 120px">Giá trị Min</th>
        <th class="text-center" style="width: 120px">Giá trị Min</th>
        <th class="text-center" style="width: 120px">Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of itemTable.data; index as i">
        <td>{{ i + 1 }}</td>
        <td><div [innerHtml]="data.name"></div></td>
        <td>{{ data.typeName }}</td>
        <td>{{ data.unitName }}</td>
        <td class="text-center">{{ data.minValue ? data.minValue : "-" }}</td>
        <td class="text-center">{{ data.maxValue ? data.maxValue : "-" }}</td>
        <td class="text-center"><a>Sửa</a> | <a>Xóa</a></td>
      </tr>
    </tbody>
  </ng-template>
  <ng-template [ngIf]="master != 0">
    <thead>
      <tr>
        <th class="text-center" style="width: 80px">STT</th>
        <th class="text-center" style="width: 300px">Tên hạng mục</th>
        <th class="text-center" style="width: 160px">Loại hạng mục</th>
        <th class="text-center" style="width: 160px">Đơn vị kiểm tra</th>
        <th class="text-center" style="width: 120px">Giá trị Min</th>
        <th class="text-center" style="width: 120px">Giá trị Max</th>
        <th class="text-center" style="width: 120px">Giá trị thực</th>
        <th class="text-center" style="width: 180px">Thực hiện</th>
        <th class="text-center" style="width: 180px">Thời gian</th>
        <th class="text-center" style="width: 120px" nzRight>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of itemTable.data; index as i">
        <td class="text-center">{{ i + 1 }}</td>
        <td><div [innerHtml]="data.name"></div></td>
        <td>{{ data.typeName }}</td>
        <td>{{ data.unitName }}</td>
        <td class="text-center">{{ data.minValue ? data.minValue : "-" }}</td>
        <td class="text-center">{{ data.maxValue ? data.maxValue : "-" }}</td>
        <td
          [ngClass]="{
            'text-center': true,
            invalid: data.evaluate == 'NG',
            valid: data.evaluate == 'OK'
          }"
        >
          {{ data.actualValue }}
        </td>
        <td>{{ data.employeeName }}</td>
        <td>{{ data.updatedAt | date: "yyyy-MM-dd HH:mm:ss" }}</td>
        <td class="text-center" nzRight>
          <a (click)="openDetailModal(data)">Sửa</a> | <a>Xóa</a>
        </td>
      </tr>
    </tbody>
  </ng-template>
</nz-table>

<nz-modal nzTitle="Thêm mới hạng mục" [(nzVisible)]="isOpenAddNewModal">
  <ng-container *nzModalContent>
    <div nz-row nzJustify="start" nzAlign="middle" [nzGutter]="24">
      <div nz-col nzXs="12" nzSm="12" nzLg="24">
        <label nzXs="24" nzSm="24" nzLg="24">Tên hạng mục</label>
        <div nzXs="24" nzSm="24" nzLg="24">
          <input
            type="text"
            nz-input
            placeholder="Nhập tên hạng mục"
            [(ngModel)]="itemAdd.name"
          />
        </div>
      </div>
      <div nz-col nzXs="12" nzSm="12" nzLg="12">
        <label nzXs="24" nzSm="24" nzLg="24">Loại hạng mục</label>
        <div nzXs="24" nzSm="24" nzLg="24">
          <nz-select nzPlaceHolder="Loại hạng mục" [(ngModel)]="itemAdd.type">
            <nz-option nzValue="1" nzLabel="Điểm kiểm tra"></nz-option>
            <nz-option nzValue="2" nzLabel="Vệ sinh"></nz-option>
          </nz-select>
        </div>
      </div>
      <div nz-col nzXs="12" nzSm="12" nzLg="12">
        <label nzXs="24" nzSm="24" nzLg="24">Đơn vị</label>
        <div nzXs="24" nzSm="24" nzLg="24">
          <nz-select nzPlaceHolder="Đơn vị" [(ngModel)]="itemAdd.unit">
            <nz-option nzValue="1" nzLabel="Giá trị thực tế"></nz-option>
            <nz-option nzValue="2" nzLabel="OK / NG"></nz-option>
          </nz-select>
        </div>
      </div>
      <ng-template [ngIf]="itemAdd.unit == 1">
        <div nz-col nzXs="12" nzSm="12" nzLg="12">
          <label nzXs="24" nzSm="24" nzLg="24">Giá trị Min</label>
          <div nzXs="24" nzSm="24" nzLg="24">
            <input
              type="number"
              nz-input
              placeholder="Nhập giá trị min"
              [(ngModel)]="itemAdd.minValue"
            />
          </div>
        </div>
        <div nz-col nzXs="12" nzSm="12" nzLg="12">
          <label nzXs="24" nzSm="24" nzLg="24">Giá trị Max</label>
          <div nzXs="24" nzSm="24" nzLg="24">
            <input
              type="number"
              nz-input
              placeholder="Nhập giá trị max"
              [(ngModel)]="itemAdd.maxValue"
            />
          </div>
        </div>
      </ng-template>
    </div>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button nzType="default" (click)="cancelAddItem()">Hủy</button>
    <button nz-button nzType="primary" (click)="addItem()">Thêm</button>
  </div>
</nz-modal>

<nz-modal
  nzTitle="Edit check sheet detail"
  [(nzVisible)]="isOpenEditDetailModal"
>
  <ng-container *nzModalContent>
    <nz-table
      nzBordered
      nzSize="small"
      [nzFrontPagination]="false"
      [nzData]="['']"
    >
      <ng-template [ngIf]="detailSelected.unit == 1">
        <tbody>
          <tr>
            <td><label>Hạng mục</label></td>
            <td>{{ detailSelected.name }}</td>
          </tr>
          <tr>
            <td><label>Đơn vị</label></td>
            <td>{{ detailSelected.unitName }}</td>
          </tr>
          <tr>
            <td><label>Tiêu chuẩn</label></td>
            <td>
              {{ detailSelected.minValue }} ~ {{ detailSelected.maxValue }}
            </td>
          </tr>
          <tr>
            <td><label>Thực tế</label></td>
            <td>
              <input
                #actualInput
                type="number"
                nz-input
                placeholder="Nhập giá trị"
                [(ngModel)]="detailSelected.actualValue"
                [autofocus]="true"
              />
            </td>
          </tr>
          <tr>
            <td><label>Ghi chú</label></td>
            <td>
              <textarea
                rows="2"
                nz-input
                placeholder="Nhập ghi chú"
                [(ngModel)]="detailSelected.note"
              >
              </textarea>
            </td>
          </tr>
        </tbody>
      </ng-template>
      <ng-template [ngIf]="detailSelected.unit == 2">
        <tbody>
          <tr>
            <td><label>Hạng mục</label></td>
            <td>{{ detailSelected.name }}</td>
          </tr>
          <tr>
            <td><label>Đơn vị</label></td>
            <td>{{ detailSelected.unitName }}</td>
          </tr>
          <tr>
            <td><label>Thực tế</label></td>
            <td>
              <nz-radio-group [(ngModel)]="detailSelected.actualValue">
                <label nz-radio nzValue="OK" style="color: green">OK</label>
                <label nz-radio nzValue="NG" style="color: red">NG</label>
              </nz-radio-group>
            </td>
          </tr>
          <tr>
            <td><label>Ghi chú</label></td>
            <td>
              <textarea
                rows="2"
                nz-input
                placeholder="Nhập ghi chú"
                [(ngModel)]="detailSelected.note"
              >
              </textarea>
            </td>
          </tr>
        </tbody>
      </ng-template>
    </nz-table>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button nzType="default" (click)="onCancelEditDetail()">
      <i nz-icon nzType="close"></i>Hủy
    </button>
    <button nz-button nzType="primary" (click)="onEditDetail()">
      <i nz-icon nzType="save"></i>
      Lưu
    </button>
  </div>
</nz-modal>
